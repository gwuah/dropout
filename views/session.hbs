

<!DOCTYPE html  >
<html lang="en">

<head>
    <title>Dropout</title>
    <link rel="stylesheet" href="/static/stylesheets/codemirror.css">
    <link rel="stylesheet" href="/static/stylesheets/monokai.css">
</head>

<body>
    <div id="code-editor">
      <div class="hde" style="display: none">{{ code }}</div>
    </div> 
    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous">
      </script>
    <script src="/static/js/ot.js"></script>   
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.39.2/codemirror.js"></script>
    <script src="/static/js/javascript.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const EditorClient = ot.EditorClient
        const SocketIOAdapter = ot.SocketIOAdapter
        const CodeMirrorAdapter = ot.CodeMirrorAdapter

        const socket = io('http://localhost:3000');
        const editor = CodeMirror(document.getElementById('code-editor'), {
            lineNumbers: true,
            theme: "monokai",
            mode: 'javascript'
        })

        let code = $('#code-editor').val();
        let client;
        function init(str, revision, clients, serverAdapter) {
          if (!code) {
            editor.setValue(str)
          }
            client = window.client = new EditorClient(
                revision, clients, serverAdapter, new CodeMirrorAdapter(editor)
            )
        }
        const sessionId = window.location.href.split("session")[1].split("/")[1];
        socket.emit('joinSession', {session: sessionId})
        socket.emit('mydoc', {session: 'kooltr'})
        socket.on('doc', (obj) => {
            console.log('heyyyy')
            init(obj.str, obj.revision, obj.clients, new SocketIOAdapter(socket))
        })
        
    </script>
    
</body>

</html>